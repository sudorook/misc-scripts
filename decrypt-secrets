#! /bin/bash
set -eu
source globals

show_warning "Encfs does not provide robust security."

mkdir -p ${encryptpath}
mkdir -p ${decryptpath}

if grep ${decryptpath} /etc/mtab >/dev/null 2>&1; then
  gio set ${decryptpath} -t string metadata::custom-icon-name folder-unlocked
  show_info "${decryptpath} is already decrypted."
  exit 0
fi

encfs ${encryptpath} ${decryptpath}

if grep ${decryptpath} /etc/mtab >/dev/null 2>&1; then
  gio set ${decryptpath} -t string metadata::custom-icon-name folder-unlocked
  show_success "Decrypted successfully."
else
  gio unset ${decryptpath} -t string metadata::custom-icon-name
  show_success "Decryption failed."
fi
