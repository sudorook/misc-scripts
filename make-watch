#! /bin/bash
set -eu

ROOT="$(dirname "${0}")"

source "${ROOT}"/globals

! check_command find entr make && exit 3

DIR="${1:-.}"

if ! [ -f "${DIR}"/Makefile ]; then
  show_error "ERROR: Makefile not found in ${DIR@Q}. Exiting."
  exit 3
fi

find "${DIR}" -type f | entr -s "make -j$(nproc) -C ${DIR}"
