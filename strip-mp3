#! /bin/bash
set -eu
source globals

#
# Check inputs and requirements.
#

if ! [ -f "${1}" ]; then
  show_error "ERROR: ${1} not found. Exiting."
  exit 3
fi

! check_command mid3v2 ffmpeg && exit 3


#
# Main
#

TMP="$(mktemp)"
EXTENSION=${1##*.}

trap 'rm -f ${TMP}; exit' INT TERM ERR

ffmpeg -i "${1}" -map_metadata -1 -map 0:a -c:a copy -f "${EXTENSION}" "${TMP}" -y
mid3v2 -D "${TMP}"
mv "${TMP}" "${1}"
sync
