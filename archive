#! /bin/bash
set -eu
source globals

if [ $# != 1 ]; then
  show_error "Incorrect # of parameters."
  echo "Usage: archive /path/to/directory"
  exit 1
fi

dir="${1}"
if [ "${dir:0:2}" = "~/" ]; then
  dir="${HOME}/${dir:2}"
fi

if [ -d "${dir}" ]; then
  archive=$(basename ${dir} | tr "[:upper:]" "[:lower:]" | \
            sed -e "s/^\.//g")_$(date +%Y%m%d-%I%M%S)
  if command -v pigz >/dev/null 2>&1; then
    tar cf - --exclude='*.sw[a-p]' ${dir} | \
      pigz > "${HOME}/Desktop/${archive}.tar.gz"
  else
    tar czf "${HOME}/Desktop/${archive}.tar.gz" --exclude='*.sw[a-p]' ${dir}
  fi
else
  show_error "${dir} is not a directory."
  exit 1
fi
